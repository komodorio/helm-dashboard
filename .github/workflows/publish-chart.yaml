name: publish helm chart

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "charts/**"

env:
  HELM_REP: helm-charts
  GH_OWNER: komodorio
  CHART_DIR: charts/helm-dashboard

jobs:
  publish_chart:
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch'
    steps:
      - name: Test
        run: echo "Hi"
      # - name: Pushes test folder
      #   uses: datalbry/copy_folder_to_another_repo_action@1.0.0
      #   env:
      #     API_TOKEN_GITHUB: ${{ secrets.ADMIN_KOMI_GITHUB_TOKEN }}
      #   with:
      #     source_folder: "test_files"
      #     destination_repo: "dmnemec/release-test"
      #     destination_folder: "test-dir"
      #     user_email: "komi@komodor.io"
      #     user_name: "komodor-bot"
      #     commit_msg: "[GHA] Update the test files."

      # - name: Install chart-releaser
      #   run: |
      #     wget https://github.com/helm/chart-releaser/releases/download/v1.3.0/chart-releaser_1.3.0_linux_amd64.tar.gz
      #     echo "baed2315a9bb799efb71d512c5198a2a3b8dcd139d7f22f878777cffcd649a37  chart-releaser_1.3.0_linux_amd64.tar.gz" | sha256sum -c -
      #     tar xzvf chart-releaser_1.3.0_linux_amd64.tar.gz cr
      # - name: Package helm chart
      #   run: |
      #     ./cr package ${{ env.CHART_DIR }}
      # - name: Upload helm chart
      #   # Failed with upload the same version: https://github.com/helm/chart-releaser/issues/101
      #   continue-on-error: true
      #   run: |
      #     ./cr upload -o ${{ env.GH_OWNER }} -r ${{ env.HELM_REP }} --token ${{ secrets.ORG_REPO_TOKEN }} -p .cr-release-packages
      # - name: Index helm chart
      #   run: |
      #     ./cr index -o ${{ env.GH_OWNER }} -r ${{ env.HELM_REP }} -c https://${{ env.GH_OWNER }}.github.io/${{ env.HELM_REP }}/ -i index.yaml
